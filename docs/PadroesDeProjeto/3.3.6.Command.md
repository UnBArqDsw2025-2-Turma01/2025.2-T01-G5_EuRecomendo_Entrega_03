# 3.3.6. Command

## Introdução

O Command é um padrão comportamental GoF que transforma uma requisição em um objeto independente contendo toda informação sobre ela. Na aplicação "EuRecomendo", aplicamos este padrão para:

**Aplicação Principal:** Encapsular ações do usuário (recomendar livro, favoritar, criar lista, avaliar) como objetos comando, permitindo execução, armazenamento, desfazer operações (undo/redo) e manter histórico completo de ações para auditoria.

Vale ressaltar que o padrão Command é normalmente usado quando:

- Você precisa parametrizar objetos com operações
- Deseja enfileirar operações, agendar sua execução ou executá-las remotamente
- Necessita implementar operações reversíveis (undo/redo)
- Quer manter histórico de requisições para auditoria
- Precisa desacoplar o objeto que invoca a operação daquele que a executa
- Deseja suportar transações e logs de operações

## Objetivo

Para a nossa aplicação do padrão no EuRecomendo:

- Encapsular ações do usuário como objetos comando independentes
- Implementar sistema de undo/redo para desfazer ações acidentais 
- Registrar histórico completo de ações para auditoria
- Permitir agendamento e enfileiramento de operações
- Desacoplar interface de usuário da lógica de negócio
- Facilitar logging e rastreamento de todas as operações

## Vantagens

- **Princípio de Responsabilidade Única:** Desacopla classes que invocam operações daquelas que as executam
- **Princípio Aberto/Fechado:** Introduz novos comandos sem modificar código existente
- **Implementação de undo/redo:** Reversão de operações de forma elegante
- **Operações compostas:** Agrupa comandos simples em complexos
- **Execução adiada:** Enfileira e agenda operações
- **Logging e auditoria:** Registra histórico completo de ações

## Desvantagens

- **Aumento de complexidade:** Adiciona muitas classes pequenas ao código
- **Overhead de memória:** Armazenar histórico consome recursos
- **Complexidade de undo:** Operações complexas são difíceis de reverter
- **Estado inconsistente:** Undo pode falhar se estado do sistema mudou
- **Curva de aprendizado:** Padrão mais complexo para entender
- **Manutenibilidade:** Muitos comandos requerem mais manutenção

## Metodologia

Para a realização deste projeto, adotamos uma abordagem estruturada:

**Ferramentas:**
- VS Code para desenvolvimento
- Django/DRF para implementação do backend
- PostgreSQL para persistência de comandos
- Docker para containerização
- pytest/Django TestCase para testes
- Postman para testes de API

**Processo de Desenvolvimento:**
1. Estudo aprofundado do padrão Command através das referências bibliográficas
2. Análise dos requisitos do EuRecomendo para identificar ações encapsuláveis
3. Modelagem da hierarquia: Command → ConcreteCommands (Recommend, Favorite, Rate)
4. Implementação do CommandHistory para undo/redo
5. Criação de endpoints REST para executar e reverter comandos
6. Validação através de casos de uso reais
7. Documentação técnica detalhada

**Referências:**
- Gamma, E. et al. **Design Patterns: Elements of Reusable Object-Oriented Software**. Addison-Wesley, 1995.
- Refactoring Guru - Command Pattern: https://refactoring.guru/design-patterns/command
- Python Design Patterns: https://python-patterns.guide/gang-of-four/command/
- Django Documentation: https://docs.djangoproject.com/
- GeeksforGeeks - Command Pattern: https://www.geeksforgeeks.org/command-method-python-design-patterns/

O desenvolvimento seguiu abordagem iterativa, começando com estudo teórico profundo do padrão, seguido por análise do domínio do problema, modelagem UML, implementação com TDD, e documentação contínua dos aprendizados.

## Aplicação no EuRecomendo

### Código

#### Interface Command Base (backend/commands/command.py)

Interface abstrata para todos os comandos:

```python
from abc import ABC, abstractmethod
from typing import Dict, Any
from datetime import datetime

class Command(ABC):
    """Interface base para todos os comandos."""
    
    def __init__(self, user_id: int):
        self.user_id = user_id
        self.executed_at = None
        self.undone_at = None
    
    @abstractmethod
    def execute(self) -> Dict[str, Any]:
        """Executa o comando e retorna resultado."""
        pass
    
    @abstractmethod
    def undo(self) -> Dict[str, Any]:
        """Desfaz o comando e retorna resultado."""
        pass
    
    @abstractmethod
    def get_description(self) -> str:
        """Retorna descrição legível do comando."""
        pass
    
    def mark_executed(self):
        """Marca comando como executado."""
        self.executed_at = datetime.now()
    
    def mark_undone(self):
        """Marca comando como desfeito."""
        self.undone_at = datetime.now()
    
    def to_dict(self) -> Dict[str, Any]:
        """Serializa comando para dicionário."""
        return {
            'type': self.__class__.__name__,
            'user_id': self.user_id,
            'executed_at': self.executed_at.isoformat() if self.executed_at else None,
            'undone_at': self.undone_at.isoformat() if self.undone_at else None,
            'description': self.get_description()
        }
```

**Autores:** Henrique Quenino e Iago Rocha, 2025

### Passo a Passo para Rodar os Códigos

#### 1. Aplicar migrações

```bash
docker compose exec web python manage.py makemigrations commands
docker compose exec web python manage.py migrate
```


## Bibliografia

- Gamma, E. et al. **Design Patterns: Elements of Reusable Object-Oriented Software**. Addison-Wesley, 1995.
- Refactoring Guru - Command Pattern: https://refactoring.guru/design-patterns/command
- Python Design Patterns - Command: https://python-patterns.guide/gang-of-four/command/
- GeeksforGeeks - Command Pattern: https://www.geeksforgeeks.org/command-method-python-design-patterns/
- Wikipedia - Command Pattern: https://en.wikipedia.org/wiki/Command_pattern
- Django REST Framework: https://www.django-rest-framework.org/
- Django Documentation: https://docs.djangoproject.com/

## Histórico de Versões

| Versão | Data | Descrição | Autor(es) |
|--------|------|-----------|-----------|
| 0.1 | 24/10/2025 | Criação inicial do documento | Henrique Quenino e Iago Rocha |
| 0.2 | 24/10/2025 | Adição de código completo com undo/redo | Henrique Quenino e Iago Rocha |
| 1.0 | 24/10/2025 | Versão final com todos os componentes implementados | Henrique Quenino e Iago Rocha |